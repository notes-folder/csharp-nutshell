#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"}]}}

#!csharp

/*
    4.14.3 è‡ªå®šä¹‰éšå¼å’Œæ˜¾å¼è½¬æ¢
    éšå¼å’Œæ˜¾å¼è½¬æ¢ä¹Ÿæ˜¯å¯é‡è½½çš„è¿ç®—ç¬¦ã€‚
    è¿™äº›è½¬æ¢ç»è¿‡é‡è½½åï¼Œä¸€èˆ¬èƒ½ä½¿å¼ºç›¸å…³çš„ç±»å‹ï¼ˆä¾‹å¦‚æ•°å­—ï¼‰ä¹‹é—´çš„è½¬æ¢å˜å¾—æ›´åŠ ç®€æ˜è‡ªç„¶ã€‚
    å¦‚æœè¦åœ¨å¼±ç›¸å…³çš„ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œåˆ™æ›´é€‚åˆé‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š
        Â· ç¼–å†™ä¸€ä¸ªä»¥è½¬æ¢ç±»å‹ä¸ºå‚æ•°çš„æ„é€ å™¨
        Â· ç¼–å†™ï¼ˆé™æ€çš„ï¼‰ToXXXå’ŒFromXXXæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢ã€‚
    ä¹‹å‰æˆ‘ä»¬åœ¨ä»‹ç»ç±»å‹æ—¶æåˆ°ï¼Œéšå¼è½¬æ¢æ„å‘³ç€å®ƒèƒ½å¤Ÿä¿è¯è½¬æ¢ä¸€å®šæˆåŠŸï¼Œä¸”è½¬æ¢æ—¶ä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚
    ç›¸åï¼Œè‹¥è½¬æ¢æˆåŠŸä¸å¦å–å†³äºè¿è¡Œæ—¶ç¯å¢ƒï¼Œæˆ–è½¬æ¢è¿‡ç¨‹ä¸­å¯èƒ½ä¸¢å¤±ä¿¡æ¯ï¼Œåˆ™åº”å½“ä½¿ç”¨æ˜¾å¼è½¬æ¢ã€‚
*/

// åœ¨ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†Noteç±»å‹å’Œdoubleï¼ˆä»£è¡¨ä»¥èµ«å…¹ä¸ºå•ä½çš„éŸ³ç¬¦é¢‘ç‡ï¼‰ä¹‹é—´çš„è½¬æ¢è§„åˆ™ï¼š
public struct Note
{
    public double value;
    public Note(double semitonesFromA) { value = semitonesFromA; }
    public static Note operator +(Note x, double semitones)
    {
        return new Note(x.value + semitones);
    }

    // Convert to hertz
    public static implicit operator double(Note x)
    => 440 * Math.Pow(2, (double)x.value / 12);

    // Convert from hertz (accurate to the nearest semitone)
    public static explicit operator Note(double x)
    => new Note((int)(0.5 + 12 * (Math.Log(x / 440) / Math.Log(2))));
}


Note n = (Note)554.37;  // explicit conversion
double x = n;             // implicit conversion
Console.WriteLine(x);     // 554.365261953744

#!csharp

/*
    ğŸ¦ æŒ‰ç…§ä¹‹å‰çš„è§„åˆ™ï¼Œä¸Šä¾‹ä¸­å®ç°ToFrequencyï¼ˆä¸é™æ€çš„FromFrequencyï¼‰æ–¹æ³•ç›¸æ¯”éšå¼å’Œæ˜¾å¼è¿ç®—ç¬¦é‡è½½å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©
*/

// ğŸ¦ aså’Œisè¿ç®—ç¬¦ä¼šå¿½ç•¥è‡ªå®šä¹‰è½¬æ¢ï¼š
Console.WriteLine(554.37 is Note);    // False
Note n = 554.37 as Note;                // Error
