#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"}]}}

#!csharp

/*
    4.6.4 è¿­ä»£å™¨è¯­ä¹‰
    è¿­ä»£å™¨æ˜¯åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªyieldè¯­å¥çš„æ–¹æ³•ã€å±æ€§æˆ–è€…ç´¢å¼•å™¨ã€‚
    è¿­ä»£å™¨å¿…é¡»è¿”å›ä»¥ä¸‹å››ä¸ªæ¥å£ä¹‹ä¸€ï¼ˆå¦åˆ™ç¼–è¯‘å™¨ä¼šäº§ç”Ÿç›¸åº”é”™è¯¯ï¼‰ï¼š
        // Enumerable interfaces
        System.Collections.IEnumerable
        System.Collections.Generic.IEnumerable<T>

        // Enumerator interfaces
        System.Collections.IEnumerator
        System.Collections.Generic.IEnumerator<T>
*/

#!csharp

/*
    è¿­ä»£å™¨å…·æœ‰ä¸åŒçš„è¯­ä¹‰ï¼Œå–å†³äºè¿­ä»£å™¨è¿”å›çš„æ˜¯å¯æšä¸¾æ¥å£è¿˜æ˜¯æšä¸¾å™¨æ¥å£ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬7ç« è¯´æ˜ã€‚
*/

//å…è®¸ä½¿ç”¨å¤šä¸ªyield statementsï¼Œä¾‹å¦‚ï¼š
IEnumerable<string> Foo()
{
    yield return "One";
    yield return "Two";
    yield return "Three";
}

foreach (string s in Foo())
{
    Console.WriteLine(s);           // Prints "One", "Two", "Three"
}

#!csharp

/*
    4.6.4.1 yield breakè¯­å¥
    yield breakè¯­å¥è¡¨æ˜è¿­ä»£å™¨å—ä¸å†è¿”å›æ›´å¤šçš„å…ƒç´ è€Œæ˜¯æå‰é€€å‡ºã€‚
*/

//æˆ‘ä»¬å¯ä»¥å°†Fooä¿®æ”¹ä¸ºä¸‹é¢çš„ç¤ºä¾‹ï¼š
IEnumerable<string> Foo(bool breakEarly)
{
    yield return "One";
    yield return "Two";

    if (breakEarly)
        yield break;

    yield return "Three";
}

foreach (string s in Foo(true))
{
    Console.WriteLine(s);           // Prints "One", "Two"
}

//ğŸ¦è¿­ä»£å™¨è¯­å¥å—ä¸­ä½¿ç”¨returnè¯­å¥æ˜¯éæ³•çš„ï¼Œåº”å½“ä½¿ç”¨yield breakã€‚

#!csharp

/*
    4.6.4.2 è¿­ä»£å™¨å’Œtry/catch/finallyè¯­å¥å—
*/

//yield returnè¯­å¥ä¸èƒ½å‡ºç°åœ¨å¸¦catchå­å¥çš„tryè¯­å¥å—ä¸­ï¼š
IEnumerable<string> Foo()
{
    try
    {
        yield return "One";
    }     // Illegal
    catch
    {
        //... 
    }
}

#!csharp

/*
    yield returnè¯­å¥ä¹Ÿä¸èƒ½å‡ºç°åœ¨catchæˆ–è€…finallyè¯­å¥å—ä¸­ã€‚
    å‡ºç°è¿™äº›é™åˆ¶çš„åŸå› æ˜¯ç¼–è¯‘å™¨å¿…é¡»å°†è¿­ä»£å™¨è½¬æ¢ä¸ºå¸¦æœ‰MoveNextã€Currentå’ŒDisposeæˆå‘˜çš„æ™®é€šç±»ï¼Œè€Œè½¬æ¢å¼‚å¸¸å¤„ç†è¯­å¥å—ä¼šå¤§å¤§å¢åŠ ä»£ç çš„å¤æ‚æ€§ã€‚
*/

//ä½†æ˜¯å¯ä»¥åœ¨åªå¸¦æœ‰finallyå—çš„tryè¯­å¥å—ä¸­ä½¿ç”¨yieldè¯­å¥ï¼š
IEnumerable<string> Foo()
{
    try
    {
        yield return "One"; // OK
    }
    finally
    {
        //...
    }
}

#!csharp

/*
    å½“æšä¸¾å™¨åˆ°è¾¾åºåˆ—æœ«å°¾æˆ–è¢«é”€æ¯æ—¶å°±å¯ä»¥æ‰§è¡Œfinallyå—äº†ã€‚
    å¦‚æœæšä¸¾æå‰ç»“æŸï¼Œåˆ™foreachè¯­å¥ä¼šéšå¼é”€æ¯æšä¸¾å™¨ï¼Œè¿™æ˜¯æ¶ˆè´¹æšä¸¾å™¨çš„å®‰å…¨ä¸”æ­£ç¡®çš„åšæ³•ã€‚
    å½“æ˜¾å¼ä½¿ç”¨æšä¸¾å™¨æ—¶ï¼Œä¸€ä¸ªé™·é˜±æ˜¯æå‰ç»“æŸæšä¸¾è€Œä¸é”€æ¯æšä¸¾å™¨ï¼Œä»è€Œç»•è¿‡finallyå—çš„æ‰§è¡Œã€‚
    æˆ‘ä»¬å¯ä»¥å°†æšä¸¾å™¨çš„ä½¿ç”¨æ˜¾å¼åŒ…è£¹åœ¨usingè¯­å¥ä¸­æ¥é¿å…ä¸Šè¿°é”™è¯¯ã€‚
*/
string firstElement = null;
var sequence = Foo();
using (var enumerator = sequence.GetEnumerator())
    if (enumerator.MoveNext())
    {
        firstElement = enumerator.Current;
        Console.WriteLine(firstElement);
    }
