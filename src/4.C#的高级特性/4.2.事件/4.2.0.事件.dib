#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"}]}}

#!csharp

/*
    4.2 äº‹ä»¶
    å½“ä½¿ç”¨å§”æ‰˜æ—¶ï¼Œä¸€èˆ¬ä¼šå‡ºç°ä¸¤ç§è§’è‰²ï¼šå¹¿æ’­è€…ï¼ˆbroadcasterï¼‰å’Œè®¢é˜…è€…ï¼ˆsubscriberï¼‰ã€‚
    å¹¿æ’­è€…æ˜¯åŒ…å«å§”æ‰˜å­—æ®µçš„ç±»å‹ï¼Œå®ƒé€šè¿‡è°ƒç”¨å§”æ‰˜å†³å®šä½•æ—¶è¿›è¡Œå¹¿æ’­ã€‚
    è€Œè®¢é˜…è€…æ˜¯æ–¹æ³•çš„ç›®æ ‡æ¥æ”¶è€…ã€‚è®¢é˜…è€…é€šè¿‡åœ¨å¹¿æ’­è€…çš„å§”æ‰˜ä¸Šè°ƒç”¨+=å’Œ-=æ¥å†³å®šä½•æ—¶å¼€å§‹ç›‘å¬è€Œä½•æ—¶ç›‘å¬ç»“æŸã€‚
    è®¢é˜…è€…ä¸çŸ¥é“ä¹Ÿä¸ä¼šå¹²æ¶‰å…¶ä»–çš„è®¢é˜…è€…ã€‚
    è€Œäº‹ä»¶å°±æ˜¯æ­£å¼å®šä¹‰è¿™ä¸€æ¨¡å¼çš„è¯­è¨€åŠŸèƒ½ã€‚
    äº‹ä»¶æ˜¯ä¸€ç§ä½¿ç”¨æœ‰é™çš„å§”æ‰˜åŠŸèƒ½å®ç°å¹¿æ’­è€…/è®¢é˜…è€…æ¨¡å‹çš„ç»“æ„ã€‚
    ä½¿ç”¨äº‹ä»¶çš„ä¸»è¦ç›®çš„åœ¨äºä¿è¯è®¢é˜…è€…ä¹‹é—´ä¸äº’ç›¸å½±å“ã€‚
*/

// å£°æ˜äº‹ä»¶æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨å§”æ‰˜æˆå‘˜çš„å‰é¢åŠ ä¸Ševentå…³é”®å­—ï¼š
// Delegate definition
public delegate void PriceChangedHandler(decimal oldPrice, decimal newPrice);
public class Broadcaster
{
    // Event declaration
    public event PriceChangedHandler PriceChanged;
}

/*
    Broadcasterç±»å‹ä¸­çš„ä»£ç å¯¹PriceChangedæœ‰å®Œå…¨çš„è®¿é—®æƒé™ï¼Œå¹¶å¯ä»¥å°†å…¶è§†ä¸ºå§”æ‰˜ã€‚
    è€ŒBroadcasterç±»å‹ä¹‹å¤–çš„ä»£ç åˆ™ä»…å¯ä»¥åœ¨PriceChangedäº‹ä»¶ä¸Šæ‰§è¡Œ+=å’Œ-=è¿ç®—ã€‚
*/

#!csharp

/*
    äº‹ä»¶çš„å·¥ä½œæœºåˆ¶æ˜¯æ€æ ·çš„
*/

// å½“å£°æ˜å¦‚ä¸‹çš„å§”æ‰˜æ—¶ï¼Œåœ¨å†…éƒ¨å‘ç”Ÿäº†ä¸‰ä»¶äº‹æƒ…ï¼š
public class Broadcaster
{
    public event PriceChangedHandler PriceChanged;
}

// é¦–å…ˆï¼Œç¼–è¯‘å™¨å°†äº‹ä»¶çš„å£°æ˜ç¿»è¯‘ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š
PriceChangedHandler priceChanged;    // private delegate
public event PriceChangedHandler PriceChanged
{
    add { priceChanged += value; }
    remove { priceChanged -= value; }
}


/*
    addå’Œremoveå…³é”®å­—æ˜ç¡®äº†äº‹ä»¶çš„è®¿é—®å™¨ï¼Œå°±åƒå±æ€§çš„è®¿é—®å™¨é‚£æ ·ã€‚
    è€Œåï¼Œç¼–è¯‘å™¨åœ¨Broadcasterç±»é‡Œé¢æ‰¾åˆ°é™¤è°ƒç”¨+=å’Œ-=ä¹‹å¤–çš„priceChangedå¼•ç”¨ç‚¹ï¼Œå¹¶å°†å®ƒä»¬é‡å®šå‘åˆ°å†…éƒ¨çš„priceChangedå§”æ‰˜å­—æ®µã€‚
    æœ€åï¼Œç¼–è¯‘å™¨å¯¹äº‹ä»¶ä¸Šçš„+=å’Œ-=è¿ç®—ç¬¦æ“ä½œç›¸åº”åœ°è°ƒç”¨äº‹ä»¶çš„addæˆ–removeè®¿é—®å™¨ã€‚
    æœ‰æ„æ€çš„æ˜¯å½“åº”ç”¨äºäº‹ä»¶æ—¶ï¼Œ+=å’Œ-=çš„è¡Œä¸ºæ˜¯å”¯ä¸€çš„ï¼Œè€Œä¸åƒå…¶ä»–çš„æƒ…å†µä¸‹æ˜¯+å’Œ-è¿ç®—ç¬¦ä¸èµ‹å€¼è¿ç®—ç¬¦çš„ç®€å†™ã€‚
*/

#!csharp

// è§‚å¯Ÿä¸‹é¢çš„ä¾‹å­ï¼Œåœ¨Stockç±»ä¸­ï¼Œæ¯å½“Stockçš„Priceå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒPriceChangedäº‹ä»¶å°±ä¼šè§¦å‘ã€‚
public delegate void PriceChangedHandler(decimal oldPrice, decimal newPrice);
public class Stock
{
    string symbol;
    decimal price;

    public Stock(string symbol) { this.symbol = symbol; }

    public event PriceChangedHandler PriceChanged;

    public decimal Price
    {
        get { return price; }
        set
        {
            if (price == value) return;       // Exit if nothing has changed
            decimal oldPrice = price;
            price = value;
            if (PriceChanged != null)             // If invocation list not
            {
                PriceChanged(oldPrice, price);      // empty, fire event.
            }
        }
    }
}

#!csharp

/*
    æœ¬ä¾‹ä¸­ï¼Œå¦‚æœå°†eventå…³é”®å­—å»æ‰ï¼ŒPriceChangedå°±å˜æˆäº†æ™®é€šçš„å§”æ‰˜å­—æ®µï¼Œè™½ç„¶è¿è¡Œç»“æœæ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯Stockç±»å°±æ²¡æœ‰åŸæ¥å¥å£®äº†ã€‚
    å› ä¸ºè¿™æ—¶è®¢é˜…è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç›¸äº’å½±å“ï¼š
        Â· é€šè¿‡é‡æ–°æŒ‡æ´¾PriceChangedæ›¿æ¢å…¶ä»–çš„è®¢é˜…è€…ï¼ˆä¸ç”¨+=è¿ç®—ç¬¦ï¼‰ã€‚
        Â· æ¸…é™¤æ‰€æœ‰çš„è®¢é˜…è€…ï¼ˆå°†PriceChangedè®¾ç½®ä¸ºnullï¼‰ã€‚
        Â· é€šè¿‡è°ƒç”¨å…¶å§”æ‰˜å¹¿æ’­åˆ°å…¶ä»–çš„è®¢é˜…è€…ã€‚
    ğŸ¦ WinRTçš„äº‹ä»¶å…·æœ‰ç¨å¾®ä¸åŒçš„è¯­ä¹‰ï¼š
        é™„åŠ åˆ°ä¸€ä¸ªäº‹ä»¶æ—¶ä¼šè¿”å›ä¸€ä¸ªä»¤ç‰Œä»¥ä¾¿ä»äº‹ä»¶åˆ†ç¦»ã€‚
        ç¼–è¯‘å™¨é€æ˜åœ°å¼¥è¡¥äº†è¿™ä¸ªå·®å¼‚ï¼ˆå†…éƒ¨ä¿å­˜äº†ä»¤ç‰Œå­—å…¸ï¼‰ï¼Œå› æ­¤å¯ä»¥å°†WinRTäº‹ä»¶å½“ä½œæ™®é€šçš„CLRäº‹ä»¶æ¥ä½¿ç”¨ã€‚
*/
